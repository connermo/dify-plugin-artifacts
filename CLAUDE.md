# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Dify plugin that provides a web-based chat interface for rendering HTML code generated by LLMs. The plugin creates "artifacts" by automatically rendering HTML/CSS/JavaScript code in an interactive interface.

## Development Commands

- **Run the plugin**: `python main.py` - Starts the Dify plugin server
- **Install dependencies**: `pip install -r requirements.txt`
- **Package plugin**: `dify plugin package . -o artifacts_$(grep 'version:' manifest.yaml | cut -d' ' -f2).difypkg` - Generates the plugin package file using current version from manifest.yaml
- **Note**: `.difypkg-ignore` file excludes unnecessary files (like .git/, __pycache__, etc.) to keep package size small

## Architecture

### Plugin Structure
- **main.py**: Entry point that initializes the Dify plugin using `DifyPluginEnv()`
- **manifest.yaml**: Plugin metadata, configuration, and runtime specifications (Python 3.12)
- **settings.py**: Pydantic models for plugin configuration
- **provider/artifacts.yaml**: Plugin provider configuration with settings and endpoint definitions

### Endpoints
The plugin exposes two main endpoints:

1. **Artifact Endpoint** (`endpoints/artifact.py` → `/`):
   - Serves the main HTML interface (`artifact.html`)
   - Handles template variable replacement (e.g., `{{ bot_name }}`)
   - GET request that returns the chat interface

2. **Chat API** (`endpoints/chat.py` → `/api/chat`):
   - Handles chat interactions with the configured Dify app
   - Accepts JSON payload with `query` and optional `conversation_id`
   - Returns streaming responses via Server-Sent Events
   - Integrates with Dify's chat API using `self.session.app.chat.invoke()`

### Configuration
- **bot_name**: Customizable bot name (default: "Candy")
- **app**: Required app selector that connects to a Dify chat application
- Plugin requires endpoint and app permissions as defined in manifest.yaml

### File Organization
- `/endpoints/`: Python endpoint handlers and YAML configurations
- `/provider/`: Plugin provider settings and endpoint routing
- `/_assets/`: Static assets including screenshots and icon
- Root level contains plugin metadata, requirements, and entry point

The plugin architecture follows Dify's plugin system conventions with YAML-based endpoint routing and Python request handlers.